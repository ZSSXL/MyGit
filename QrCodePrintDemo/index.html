<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>二维码打印测试</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
	</head>
	<body>
		<div class="modal fade" tabindex="-1" role="dialog" id="qr-modal">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">二维码预览</h4>
					</div>
					<div class="modal-body">
						<!--startprint-->

						<!--打印内容开始-->
						<div class="row" id="print-content">
							<div class="col-lg-6 col-sm-6">
								<img src="images/code.png" />
							</div>
							<div class="col-lg-6 col-sm-6">
								<h3>姓名: <span class="label label-default">张三</span></h3>
								<h3>班级: <span class="label label-default">计算机161班</span></h3>
								<h3>学号: <span class="label label-default">123456789</span></h3>
								<h3>年龄: <span class="label label-default">23</span></h3>
								<h3>体重: <span class="label label-default">60kg</span></h3>
								<h3>时间: <span class="label label-default">2019-11-28 20:48</span></h3>
							</div>
						</div>
						<!--打印内容结束-->

						<!--endprint-->
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-primary" id="print">打印</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<div class="container">
			<h2>二维码打印测试</h2>
			<hr />
			<div class="row">
				<div class="col-lg-6 col-sm-12">
					<button class="btn btn-info" id="preview">预览</button>
				</div>
			</div>
		</div>
		<script src="js/jquery-3.4.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script type="text/javascript">
			$("#preview").click(function() {
				$('#qr-modal').modal('show');
			});

			$("#print").click(function() {
				// preview();
				// previewPage();
				preview2();
			});

			function preview() {
				console.log("start print ...");
				var bdhtml = window.document.body.innerHTML; //获取当前页的html代码 
				var startStr = "<!--startprint-->"; //设置打印开始区域 
				var endStr = "<!--endprint-->"; //设置打印结束区域 
				var printHtml = bdhtml.substring(bdhtml.indexOf(startStr) + startStr.length, bdhtml.indexOf(endStr)); //从标记里获取需要打印的页面 
				window.document.body.innerHTML = printHtml; //需要打印的页面 
				window.print();
				window.document.body.innerHTML = bdhtml; //还原界面 
				location.reload();
				console.log("end print ...");
			}

			function previewPage() {
				console.log("start print ...");

				var printHtml = document.getElementById("print-content").innerHTML;
				var wind = window.open("", 'newwindow', 'height=300px,width=700px');
				wind.document.body.innerHTML = printHtml;
				wind.print();
				console.log("end print ...");
				return false;
			}
		</script>
	</body>
</html>
